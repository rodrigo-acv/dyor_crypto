<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DYOR Cripto</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">


  <style>

  /*CSS */
    a {
      color: #00aaff;
    }

    a:hover {
      color: #33ccff;
    }

    .copy-btn {
      color: #00aaff;
    }

    .copy-btn:hover {
      color: #33ccff;
    }



/* Estiliza√ß√£o para cada Card separadamente com fontes e tamanhos individuais */

    body {
      font-family: 'Poppins', sans-serif;
      background-color: #0d0d0d; /* Preto elegante */
      color: #ffffff; /* Letras brancas */
      text-align: center;
      padding: 20px;
    }
    .search-container {
      margin-bottom: 20px;
    }
    
    /* Campo: Busca*/
    .search-container input {
      padding: 10px;
      width: 300px;
      margin-right: 10px;
    }
    .search-container button {
      padding: 10px 20px;
      cursor: pointer;
    }
    
    .display-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      visibility: hidden; /* Inicialmente oculto */
    }
    
    /* INFORMA√á√ïES */
    .card-info {
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 10%;
      min-width: 200px;
      background-color: #1a1a1a;  /* fundo escuro */
      color: #ffffff;             /* texto branco */
      border: 1px solid #333;     /* contorno sutil */
      font-family: 'Poppins', sans-serif; /* Fonte individual */
      font-size: 14px; /* Tamanho de fonte individual */
    }

    .card-info table {
      width: 100%;
      border-collapse: collapse;
      font-family:'Poppins', sans-serif; /* Fonte individual para tabela */
      font-size: 13px; /* Tamanho individual para tabela */
      color: #ffffff;
    }

    .card-info th, .card-info td {
      font-weight: normal;
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
      border-color: #444;
      background-color: #1a1a1a;
      color: #ffffff;
    }

    /* CONTRATO */
          .card-contract {
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 22%;
            min-width: 220px;
            background-color: #1a1a1a;  /* fundo escuro */
            color: #ffffff;             /* texto branco */
            border: 1px solid #333;     /* contorno sutil */
            font-family: 'Poppins', sans-serif; /* Fonte individual */
            font-size: 14px; /* Tamanho de fonte individual */
          }

          .card-contract table {
            width: 100%;
            border-collapse: collapse;
            font-family:'Poppins', sans-serif; /* Fonte individual para tabela */
            font-size: 11px; /* Tamanho individual para tabela */
            color: #ffffff;
          }

          .card-contract th, .card-contract td {
            font-weight: normal;
            border: 1px solid #ccc;
            padding: 2cqw;
            text-align: left;
            border-color: #444;
            background-color: #1a1a1a;
            color: #ffffff;
          }


          .copy-btn {
          background: none;
          border: none;
          cursor: pointer;
          font-size: 18px;
          margin-left: 10px;
          color: #007bff; /* Azul padr√£o */
          transition: transform 0.2s, color 0.2s;
          }

          .copy-btn:hover {
          color: #0056b3; /* Azul mais escuro ao passar o mouse */
          transform: scale(1.2); /* Efeito de leve aumento */
          }

          .copy-btn:active {
          transform: scale(0.9); /* Efeito ao clicar */
          }

          /* Tooltip (coment√°rio com o contrato completo) */
          .copy-btn::after {
            content: attr(title);
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 12px;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.2s;
            white-space: nowrap;
        }

          .copy-btn:hover::after {
            visibility: visible;
            opacity: 1;
            transform: translateY(-25px);
          }



    /* TOKENOMICS */
    .card-tokenomics {
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 40%;
      min-width: 400px;
      background-color: #1a1a1a;  /* fundo escuro */
      color: #ffffff;             /* texto branco */
      border: 1px solid #333;     /* contorno sutil */
      font-family: 'Poppins', sans-serif; /* Fonte individual */
      font-size: 14px; /* Tamanho de fonte individual */
    }

    /* Ajusta o container das tabelas para deix√°-las lado a lado */
    .tables-container {
      display: flex;
      gap: 10px; /* Espa√ßo entre as tabelas */
      justify-content: space-between; /* Alinha as tabelas igualmente */
    }

    .card-tokenomics table {
      width: 50%;
      border-collapse: collapse;
      font-family:'Poppins', sans-serif; /* Fonte individual para tabela */
      font-size: 12px; /* Tamanho individual para tabela */
      color: #ffffff;
    }

    .card-tokenomics th, .card-tokenomics td {
      font-weight: normal;
      border: 1px solid #aaa;
      padding: 10px;
      text-align: left;
      border-color: #444;
      background-color: #1a1a1a;
      color: #ffffff;
    }

    /* Tooltip styling */
    .tooltip-container {
      position: relative;
      display: inline-block;
      cursor: pointer;
    }

     /* Confira√ß√£o: Coment√°rios*/
    .tooltiptext {
      visibility: hidden;
      background-color: #405b8f;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      white-space: nowrap;
    }
    .tooltip-container:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }


    /* MARKETCAP PROGRESS BAR  */
    .card-marketcap {
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 1110px; /* mesmo valor dos outros cards/containers */
      margin: 0 auto;
      background-color: #1a1a1a;
      color: #ffffff;
      border: 1px solid #333;
    }

  .card-marketcap h2 {
    color: #f1c40f;      /* amarelo ouro (altere √† vontade) */
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 15px;
    }

  .labels span {
    color: #cccccc;       /* cinza claro */
    font-size: 12px;
    font-weight: 500;
  }


        .progress-container {
          margin-top: 20px;
        }
        .bar {
          position: relative;
          height: 20px;
          border-radius: 0px;
          background-color: #333333;
          overflow: hidden;
        }
        .fill {
          height: 100%;
          background-color: #b0e0e6;
        }

        .labels {
          display: flex;
          justify-content: space-between;
          margin-top: 10px;
          font-size: 14px;
        }


  </style>
</head>
<body>
<div class="container">
  <h1>DYOR Cripto</h1>
  <div class="search-container">
    <input type="text" id="cryptoInput" placeholder="Digite o nome ou s√≠mbolo da moeda">
    <button onclick="fetchCryptoData()">Pesquisar</button>
  </div>

  <div id="update-info" style="margin-top: 10px; padding: 20px; font-size: 14px; color: #555;"></div>

  <div class="display-container" id="cryptoData">
    <div class="card-info">
      <h2>Informa√ß√µes</h2>
      <table>
        <tr><td>Nome:</td><td id="name"></td></tr>
        <tr><td>S√≠mbolo:</td><td id="symbol"></td></tr>
        <tr><td>Classifica√ß√£o:</td><td id="rank"></td></tr>
        <tr><td>Rede Social:</td><td id="socials"></td></tr>
        <tr><td>Website:</td><td><a href="#" id="websiteLink" target="_blank" class="text-blue-500 hover:underline">üåê</a></td>
      </table>
    </div>

    <div class="card-contract">
      <h2>Contrato</h2>
      <table>
        <thead>
        <tr><th>Rede</th><th>Contrato</th></tr>
        </thead>
        <tbody id="contractBody"></tbody>
      </table>
    </div>

    <div class="card-tokenomics">
      <h2>Estat√≠sticas</h2>
      <div class="tables-container">
        <table class="token-table">
          <tr>
            <td>Pre√ßo:</td>
            <td>
              <div class="tooltip-container">
                <span id="price"></span>
                <span class="tooltiptext"></span>
              </div>
            </td>
        </tr>
            
          <tr>
            <td>MarketCap:</td>
            <td>
              <div class="tooltip-container">
                <span id="marketCap"></span>
                <span class="tooltiptext"></span>
              </div>
            </td>
          </tr>
            
          <tr>
            <td>Circulating Supply:</td>
            <td>
              <div class="tooltip-container">
                <span id="circulatingSupply"></span>
                <span class="tooltiptext"></span>
              </div>
            </td>
          </tr>

          <tr>
            <td>FDV:</td>
            <td>
              <div class="tooltip-container">
                <span id="fdv"></span>
                <span class="tooltiptext"></span>
              </div>
            </td>
          </tr>     

          <tr>
            <td>Total Supply:</td>
            <td>
              <div class="tooltip-container">
                <span id="totalSupply"></span>
                <span class="tooltiptext"></span>
              </div>
            </td>
          </tr>          


        </table>
    
        <table class="token-table">

          <tr>
            <td>% Liberado:</td>
            <td>
              <div class="tooltip-container">
                <span id="percentLiberado"></span>
                <span class="tooltiptext"></span>
              </div>
            </td>
          </tr>   

          <tr>
            <td>% Bloqueado:</td>
            <td>
              <div class="tooltip-container">
                <span id="percentBloqueado"></span>
                <span class="tooltiptext"></span>
              </div>
            </td>
          </tr>   

          <tr>
            <td>Volume 24h</td>
            <td>
              <div class="tooltip-container">
                <span id="volume24h"></span>
                <span class="tooltiptext"></span>
              </div>
            </td>
          </tr>   

          <tr>
            <td>Volume 7D:</td>
            <td>
              <div class="tooltip-container">
                <span id="volume7D"></span>
                <span class="tooltiptext"></span>
              </div>
            </td>
          </tr>   
          
          <tr>
            <td>TVL:</td>
            <td>
              <div class="tooltip-container">
                <span id="tvl"></span>
                <span class="tooltiptext"></span>
              </div>
            </td>
          </tr>   
        </table>
    </div>
  </div>
   
  <div class="card-marketcap">
    <h2>Est√°gio (MarketCap) : <span id="projectNameSpan"></span> </h2>
    <div class="progress-container">
      <div class="bar">
        <div class="fill" id="progressFill"></div>
      </div>
      <div class="labels">
        <span>Gema (at√© 150 M)</span>
        <span>Pequena (at√© 1B)</span>
        <span>M√©dia (at√© 8B)</span>
        <span>BlueShip (at√© 60B)</span>
        <span>BigPlayer (> 60B)</span>
      </div>
    </div>
  </div>


</div>

<script>
  // Formata n√∫meros com abrevia√ß√µes K, M, B, T
  function formatNumber(num) {
  if (!num || isNaN(num)) return '-';
    if (num >= 1e12) return (num / 1e12).toFixed(2) + ' T';
    if (num >= 1e9)  return (num / 1e9).toFixed(2) + ' B';
    if (num >= 1e6)  return (num / 1e6).toFixed(2) + ' M';
    if (num >= 1e3)  return (num / 1e3).toFixed(2) + ' K';
    return num.toFixed(2);
  }

  async function fetchCryptoData() {
    const crypto = document.getElementById("cryptoInput").value.trim().toLowerCase();
    if (!crypto) return alert("Digite o nome ou s√≠mbolo da moeda");

    try {
      const response = await axios.get(`https://api.coingecko.com/api/v3/coins/${crypto}`);
      const data = response.data;

      document.getElementById("cryptoData").style.visibility = "visible";

      //INFORMA√á√ïES: INICIAIS

      // Pegando o local onde ser√° exibida a atualiza√ß√£o
      const updateInfo = document.getElementById("update-info");

      // Criando a data formatada
      const now = new Date();
      const formattedDate = now.toLocaleString(); // Data e hora local

      // Definindo o texto com a data e a API
      updateInfo.innerHTML = `üìÖ Atualiza√ß√£o: ${formattedDate} | üîó Fonte de Dados: <a href="https://www.coingecko.com/" target="_blank">CoinGecko API</a>`;


      document.getElementById("projectNameSpan").textContent = data.name;
      document.getElementById("name").innerText = data.name;
      document.getElementById("symbol").innerText = data.symbol.toUpperCase();
      document.getElementById("rank").innerText = data.market_cap_rank;
      document.getElementById("price").innerText = "US$ " + data.market_data.current_price.usd;
      document.getElementById("marketCap").innerText = "US$ " + formatNumber(data.market_data.market_cap.usd);
      document.getElementById("circulatingSupply").innerText = "US$ " + formatNumber(data.market_data.circulating_supply);
      document.getElementById("fdv").innerText = "US$ " + formatNumber(data.market_data.fully_diluted_valuation.usd);
      document.getElementById("totalSupply").innerText = "US$ " + formatNumber(data.market_data.total_supply);
      document.getElementById("percentLiberado").innerText = ((data.market_data.circulating_supply / data.market_data.total_supply) * 100).toFixed(2) + " %";
      document.getElementById("percentBloqueado").innerText = (100 - (data.market_data.circulating_supply / data.market_data.total_supply)*100).toFixed(2) + " %";
      document.getElementById("volume24h").innerText =  (( data.market_data.total_volume.usd / data.market_data.market_cap.usd ) * 100).toFixed(2) + " %";
      document.getElementById("websiteLink").href = data.links.homepage[0];

      // Adicionando tooltips din√¢micos
      document.getElementById("price").nextElementSibling.innerText = `√öltima atualiza√ß√£o: ${new Date().toLocaleString()}`;;
      document.getElementById("marketCap").nextElementSibling.innerText = `Pre√ßo (${formatNumber(data.market_data.current_price.usd)}) x Circulating Supply (${formatNumber(data.market_data.circulating_supply)})`;
      document.getElementById("circulatingSupply").nextElementSibling.innerText =  `Moedas dispon√≠veis para negocia√ß√£o`;
      document.getElementById("fdv").nextElementSibling.innerText = `Estimativa se todas as moedas forem liberadas (${formatNumber(data.market_data.current_price.usd)}) x Total Supply (${formatNumber(data.market_data.total_supply)})`;      
      document.getElementById("totalSupply").nextElementSibling.innerText = `M√°ximo poss√≠vel de emiss√£o`;
      document.getElementById("percentLiberado").nextElementSibling.innerText = `(Circulating Supply (${formatNumber(data.market_data.circulating_supply)}) / Total Supply (${formatNumber(data.market_data.total_supply)}) x 100`;
      document.getElementById("percentBloqueado").nextElementSibling.innerText = "100 - % Liberado";
      document.getElementById("volume24h").nextElementSibling.innerText = `Volume 24h (${formatNumber(data.market_data.total_volume.usd)}) / MarketCap (${formatNumber(data.market_data.market_cap.usd)})`;
      


      //TVL
      // Fun√ß√£o que tenta buscar o TVL com base no texto digitado no campo de pesquisa
      async function fetchTVLDeFiLlama(crypto) {
        // Obt√©m o elemento onde o TVL ser√° exibido na sua tabela
        const tvlElement = document.getElementById("tvl");

        // Verifica se o elemento existe no HTML
        if (!tvlElement) return;

        // Pega o tooltip que est√° ao lado do valor do TVL (dentro da <span class="tooltiptext">)
        const tooltip = tvlElement.nextElementSibling;

        // --------------------------
        // 1Ô∏è‚É£ TENTA BUSCAR COMO PROTOCOLO
        // --------------------------
        try {
          // Exemplo de chamada: https://api.llama.fi/tvl/kamino
          const resProtocol = await axios.get(`https://api.llama.fi/tvl/${crypto}`);

          // Aqui, resProtocol.data j√° retorna o valor do TVL direto (n√∫mero em USD)
          const tvlFromProtocol = resProtocol.data;

          // Verifica se veio um n√∫mero
          if (typeof tvlFromProtocol === "number") {
            tvlElement.innerText = "US$ " + formatNumber(tvlFromProtocol);
            tooltip.innerText = `Fonte: DeFiLlama (TVL do protocolo "${crypto}")`;
            return; // Se encontrou, n√£o precisa buscar como blockchain
          }

        } catch (err1) {
          // Se der erro (ex: protocolo n√£o encontrado), ele segue para a pr√≥xima tentativa
          console.warn(`TVL n√£o encontrado como protocolo: ${crypto}`);
        }

        // --------------------------
        // 2Ô∏è‚É£ TENTA BUSCAR COMO BLOCKCHAIN
        // --------------------------
        try {
          // Faz a requisi√ß√£o para obter a lista completa de blockchains dispon√≠veis
          const resChains = await axios.get("https://api.llama.fi/v2/chains");

          // resChains.data √© uma array com todos os blockchains. Exemplo:
          // [{ name: "Solana", tvl: 12345678 }, { name: "Ethereum", tvl: 999999 }, ...]

          // Faz uma busca nessa lista para encontrar a blockchain que tem o mesmo nome do que foi digitado
          const chainData = resChains.data.find(chain =>
            chain.name.toLowerCase() === crypto.toLowerCase()
          );

          // Se encontrou a blockchain e ela tem o campo tvl
          if (chainData && chainData.tvl) {
            tvlElement.innerText = "US$ " + formatNumber(chainData.tvl);
            tooltip.innerText = `Fonte: DeFiLlama (TVL da blockchain "${chainData.name}")`;
            return;
          } else {
            // Caso n√£o encontre nem como protocolo nem como blockchain
            tvlElement.innerText = "TVL n√£o dispon√≠vel";
            tooltip.innerText = "TVL n√£o encontrado nas fontes p√∫blicas";
          }

        } catch (err2) {
          // Erro ao buscar como blockchain
          console.error("Erro ao buscar TVL como blockchain", err2);
        }
      }



      //CARD: INFORMA√á√ïES
      const socials = data.links;
      let socialIcons = "";
      const socialMap = {
        twitter_screen_name: "üê¶",
        telegram_channel_identifier: "üì±",
        subreddit_url: "üëæ"
      };

      for (const [key, emoji] of Object.entries(socialMap)) {
        if (socials[key]) {
          const url = key === "subreddit_url" ? socials[key] : `https://${key.includes("twitter") ? "twitter.com/" : "t.me/"}${socials[key]}`;
          socialIcons += `<a href='${url}' target='_blank'>${emoji}</a> `;
        }
      }

      document.getElementById("socials").innerHTML = socialIcons;



      //CARD: CONTRATO
      const contractBody = document.getElementById("contractBody");
      contractBody.innerHTML = "";

      Object.entries(data.platforms).forEach(([network, address]) => {
          const shortenedAddress = address.slice(0, 6) + "..." + address.slice(-6);
    
        // Criando a linha da tabela
        const row = document.createElement("tr");
        
        // Criando a c√©lula da rede
        const networkCell = document.createElement("td");
        networkCell.textContent = network;
        
        // Criando a c√©lula do endere√ßo
        const addressCell = document.createElement("td");
        addressCell.innerHTML = `<span class="full-address" style="display:none;">${address}</span>
                                <span class="short-address">${shortenedAddress}</span>`;

        // Criando o bot√£o de copiar com √≠cone real
        const copyButton = document.createElement("button");
        //copyButton.innerHTML = "&#x2398;"; // √çcone real de copiar (dois quadrados sobrepostos)
        copyButton.innerHTML = "üìã"
        copyButton.classList.add("copy-btn");
        copyButton.title = address; // Tooltip ao passar o mouse
        copyButton.onclick = () => {
            navigator.clipboard.writeText(address).then(() => {
                copyButton.innerHTML = "‚úÖ"; // √çcone de check ap√≥s copiar
                //setTimeout(() => copyButton.innerHTML = "&#x2398;", 2000); // Volta para √≠cone original
                setTimeout(() => copyButton.innerHTML = "üìã", 2000); // Volta para √≠cone original
            }).catch(err => console.error("Erro ao copiar:", err));
        };

          // Adicionando elementos √† linha
          addressCell.appendChild(copyButton);
          row.appendChild(networkCell);
          row.appendChild(addressCell);
          
          contractBody.appendChild(row);
      });

      await fetchTVLDeFiLlama(crypto);

    //************************* // 
    // MARKETCAP PROGRESS BAR   //
    //************************* //     

      // Valor din√¢mico do MarketCap em d√≥lares (exemplo real ou vindo de API)
          const marketCapUSD = data.market_data.market_cap.usd; // üí∞ Ex: 2.27 bilh√µes de d√≥lares

          // Faixas em bilh√µes
          const stages = [0, 0.15, 1, 8, 60, 300];
          const totalWidth = 100;

          // Converter o marketcap para bilh√µes
          const marketCapInBillions = marketCapUSD / 1e9;

          // Calcular a porcentagem de preenchimento
          let percentage = 0;
          if (marketCapInBillions >= stages[5]) {
            percentage = 100;
          } else {
            for (let i = 0; i < stages.length - 1; i++) {
              if (marketCapInBillions >= stages[i] && marketCapInBillions < stages[i + 1]) {
                const rangeStart = stages[i];
                const rangeEnd = stages[i + 1];
                const rangePercentStart = (i / (stages.length - 1)) * totalWidth;
                const rangePercentEnd = ((i + 1) / (stages.length - 1)) * totalWidth;
                const ratio = (marketCapInBillions - rangeStart) / (rangeEnd - rangeStart);
                percentage = rangePercentStart + ratio * (rangePercentEnd - rangePercentStart);
                break;
              }
            }
          }

          // Atualiza a largura da barra preenchida
          const fill = document.getElementById('progressFill');
          fill.style.width = `${percentage}%`;




      } catch (error) {
      alert("Moeda n√£o encontrada ou erro na API.");
    }
  }
</script>
</body>
</html>
